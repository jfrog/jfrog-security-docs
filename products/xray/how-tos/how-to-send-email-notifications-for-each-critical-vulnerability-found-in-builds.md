# How to Send Email Notifications for Each Critical Vulnerability Found in Builds

This use case describes how to configure **Xray Policies and Watches** to trigger an **email notification** for every build that contains a **Critical** vulnerability.

***

### **Involved**

* **Security Engineer**: Configures and monitors security policies in Xray.
* **DevOps Engineer**: Ensures CI/CD pipelines respect security policies.
* **Developers**: Receive email notifications and take corrective actions.

***

### **Trigger Event**

A **CI/CD build scan** detects at least one **Critical** vulnerability in the dependencies or artifacts of a build.

***

### **Preconditions**

* JFrog Xray is **enabled** and configured to scan builds.
* SMTP settings are correctly set up for **email notifications**.
* The organization has defined **policies for handling critical vulnerabilities**.

***

### **Flow of Events**

#### **Step 1: Configure Email Notifications in JFrog Platform**

ðŸ“Œ **Goal:** Ensure the JFrog Platform can send email alerts.

1. Log in to **JFrog Platform**.
2. Navigate to **Administration** â†’ **User Management** â†’ **Settings**.
3. Under **Mail Server**, configure the SMTP settings:
   * **SMTP Host**: `smtp.example.com`
   * **Port**: `587` (or `465` for SSL)
   * **Username**: `security-alerts@example.com`
   * **Password**: `<your-email-password>`
   * **From Address**: `security-alerts@example.com`
4. Click **Test Connection** to verify email setup.
5. Save the settings.

***

#### **Step 2: Define a Security Policy for Critical Vulnerabilities**

ðŸ“Œ **Goal:** Create a policy to trigger email notifications for each Critical vulnerability found in a build.

1. Navigate to **Xray** â†’ **Security & Compliance** â†’ **Policies**.
2. Click **"Create Policy"**, selecting **"Security"** as the policy type.
3. Configure the policy:
   * **Name**: `Critical Vulnerability Notification Policy`
   * **Description**: Sends an email alert whenever a build contains a critical vulnerability.
   * **Severity Threshold**: Select **Critical**.
   * **Actions**:
     * âœ… **Send Email Notification** (To security team & developers).
     * âœ… **Fail Build** (Prevents vulnerable builds from proceeding).
4. Click **Save**.

***

#### **Step 3: Attach the Policy to a Watch**

ðŸ“Œ **Goal:** Apply the security policy to monitor CI/CD builds.

1. Navigate to **Xray** â†’ **Security & Compliance** â†’ **Watches**.
2. Click **"Create Watch"**.
3. Define the **Scope**:
   * **Repositories**: Select repositories storing build artifacts (e.g., `build-repo`).
   * **Builds**: Select all relevant builds that should be monitored.
   * **Packages**: Leave blank to apply to all components within the builds.
4. Attach the `Critical Vulnerability Notification Policy`.
5. Save and activate the Watch.

***

#### **Step 4: Test Email Notification (Build with Critical Vulnerability)**

ðŸ“Œ **Goal:** Ensure that email notifications are sent when a build contains a Critical vulnerability.

**Scenario 1: Vulnerable Build in CI/CD (Blocked & Notified)**

A Jenkins pipeline attempts to build an application using a vulnerable package:

```sh
shCopyEditmvn clean package
```

âœ… **Expected Result:**

* The build **fails** due to the **Critical** vulnerability.
* The security team **receives an email notification**.

**Example Email Notification Format**

```
yamlCopyEditSubject: [ALERT] Critical Vulnerability Found in Build #42

Build Name: my-app  
Build Number: 42  
Detected Vulnerability: CVE-2023-XXXXX  
Severity: Critical  
Impacted Component: log4j-2.14.1.jar  
Risk Description: This vulnerability allows remote code execution.  

Action Required:  
- Upgrade to log4j-2.17.1 to resolve the issue.  
- Re-run the build after fixing the dependency.  

For more details, visit: https://artifactory.example.com/xray/violations
```

***

#### **Step 5: Review and Resolve Vulnerability**

ðŸ“Œ **Goal:** Investigate and fix the vulnerability before retrying the build.

1. Navigate to **Xray** â†’ **Violations**.
2. Select the **build that triggered the alert**.
3. Review:
   * **CVE Details** (e.g., CVE-2023-XXXXX).
   * **Affected dependencies** (e.g., `log4j-2.14.1`).
   * **Suggested Fixes** (e.g., upgrade to `log4j-2.17.1`).
4. Apply a fix:
   * âœ… **Upgrade to a secure package version**.
   * âœ… **Request an exception** (only in controlled cases).
5. Retry the build after remediation.

***

### **Postconditions**

* A **Critical vulnerability triggers an email notification**.
* The security team is **immediately informed** and can take action.
* Builds containing critical vulnerabilities are **blocked until fixed**.

***

### **Alternative Flows & Considerations**

* **Slack & Webhook Notifications**: If email is not preferred, notifications can be sent via Slack or Webhooks.
* **Policy Customization**:
  * Notify only for vulnerabilities in **production builds**.
  * Send different email alerts for **different severity levels**.
* **Automated Fix Suggestions**:
  * Integrate with **IDE plugins** to warn developers before they commit vulnerable dependencies.

***

### **Business Impact**

ðŸ”¹ **Ensures fast response** to critical security threats.\
ðŸ”¹ **Prevents high-risk vulnerabilities** from reaching production.\
ðŸ”¹ **Improves security visibility** across DevOps teams.

